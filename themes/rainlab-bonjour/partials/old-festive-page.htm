description = "old festive ramadan page and code"

[viewBag]
==
<?php
function onStart(){
    
    $cmsController = new Cms\Classes\Controller;
    $category = $this->param('category');
    $pages = Definite\Activities\Models\Activity::whereHas('categories',function($query) {
       $query->where('id', 18);
    })->where('slug',$category)->get()->first();
    $sortvar = "tb.updated_at";
    $sort = "Desc";
    $index= 0;
    
    if($pages){
         $this->page->title = $pages->title;
        $this->page->meta_title = $pages->meta_title;
        $this->page->meta_description = $pages->meta_description;
        if( $category == "resep-takjil-manis-tujuh-langkah"){
            $favorite = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_like', 'definite_activities_like.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('definite_activities_activity.favorite = 1 AND definite_activities_category.id = ?', [ 22 ] )->
            select(DB::raw('IFNULL(definite_activities_like.total,0) as total_likes'), 'definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image')->limit(6)->get();
            $sg = DB::select(" select slug from definite_activities_category where id = 22");
            $this["slug_category"] = $sg[0]->slug;
            
            $this["category"] = "SCM";
            $query = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by sort_top DESC, tb.updated_at DESC LIMIT 6 OFFSET 0 ");
        }elseif($category == "resep-ramadan-kue-kering-pilihan"){
            $favorite = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_like', 'definite_activities_like.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('definite_activities_activity.favorite = 1 AND definite_activities_category.id = ?', [ 21] )->
            select(DB::raw('IFNULL(definite_activities_like.total,0) as total_likes'), 'definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image')->limit(6)->get();
            $sg = DB::select(" select slug from definite_activities_category where id = 21");
            $this["slug_category"] = $sg[0]->slug;
            
            $this["category"] = "FMP";
            $query = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_like', 'definite_activities_like.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('(definite_activities_activity.favorite <> 1 or definite_activities_activity.favorite is null ) AND definite_activities_category.id = 21' )->
                select(DB::raw('IFNULL(definite_activities_like.total,0) as total_likes'), 'definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image')->orderBy('definite_activities_activity.sort_top', "desc")->orderBy("definite_activities_activity.updated_at", "DESC")->offset(0)->limit(6)->get();
        }
        else{
            
            $this['category'] = "promo";
            $favorite = [];
            $query = [];
        }
        
        $this['result'] = $favorite;
        $this['query'] = $query;
    }else{
      return $cmsController->render("/404");
    }
    //sleep(2000);
    //$this->page->amp_url = $this->pageUrl('amp-festive-category');
}


function onHandleForm()
{
    $title = Input::get('title') ? Input::get('title') : '';
    $sort = Input::get('sort');
    $category = Input::get('category');
    $index    = intval(Input::get('index'));
    $sortvar = $category == "SCM" ? 'tb.updated_at' : 'definite_activities_activity.updated_at';
    $this['populer'] = 0;
    if($sort == "populer"){
        $this['populer'] = 1;
        $sortvar = $category == "SCM" ? 'total' : 'definite_activities_like.total';
        $sort = 'desc';
    }
    
    $limit = 6;
    if($category == "SCM")
    {
        $sg = DB::select(" select slug from definite_activities_category where id = 22");
            $this["slug_category"] = $sg[0]->slug;
    }else{
        $sg = DB::select(" select slug from definite_activities_category where id = 21");
            $this["slug_category"] = $sg[0]->slug;
    }
            
    if($title == ""){
        if($category == "SCM")
        {
            if(Input::get('sort') == "populer"){
            $query = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by ".$sortvar." ".$sort." LIMIT 6 OFFSET ".$index."");
            }else{
                $query = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by sort_top desc, ".$sortvar." ".$sort." LIMIT 6 OFFSET ".$index." ");
                
            }
            $query = collect($query);
        }
    
        if($category == "FMP")
        {
            $query = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_like', 'definite_activities_like.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('(definite_activities_activity.favorite <> 1 or definite_activities_activity.favorite is null ) AND definite_activities_category.id = 21' )->
                select(DB::raw('IFNULL(definite_activities_like.total,0) as total_likes'), 'definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image');
            if(Input::get('sort') == "populer"){
                $query = $query->orderBy($sortvar, $sort)->offset($index)->limit($limit)->get();
            }else{
                $query = $query->orderBy('definite_activities_activity.sort_top', "desc")->orderBy($sortvar, $sort)->offset($index)->limit($limit)->get();
            }
           
        }
       
        header('Content-Type: application/json');
        $this['result'] = $query;
        
    }else{
        if($category == "FMP")
        {
        $allquery = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_like', 'definite_activities_like.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('(definite_activities_activity.favorite <> 1 or definite_activities_activity.favorite is null ) AND definite_activities_category.id = 21 AND ( definite_activities_activity.title like ? OR definite_activities_activity.description like ?) ', [ '%'.$title.'%', '%'.$title.'%'] )->
            select('definite_activities_like.total as total_likes','definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image');
            if($sortvar == 'definite_activities_activity.updated_at'){
                $allquery = $allquery->orderByRaw(" CASE
            WHEN definite_activities_activity.title LIKE '%".$title."%' THEN 1
            WHEN definite_activities_activity.description LIKE '%".$title."%' THEN 2
            ELSE 3
          END, definite_activities_activity.updated_at ".$sort)->offset($index)->limit($limit)->get();
            }else{
             $allquery = $allquery->orderBy($sortvar, $sort)->offset($index)->limit($limit)->get();
            }
        }else{
            if($sortvar == 'tb.updated_at'){
                $allquery = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.description, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) AND (definite_activities_activity.title like '%".$title."%' OR definite_activities_activity.description like '%".$title."%') group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by CASE
            WHEN title LIKE '%".$title."%' THEN 1
            WHEN description LIKE '%".$title."%' THEN 2
            ELSE 3
          END, ".$sortvar." ".$sort." LIMIT 6 OFFSET ".$index." ");
            }else{
                $allquery = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.description, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) AND (definite_activities_activity.title like '%".$title."%' OR definite_activities_activity.description like '%".$title."%') group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by ".$sortvar." ".$sort." LIMIT 6 OFFSET ".$index." ");
            }
            $allquery = collect($allquery);
            
        }
        header('Content-Type: application/json');
        $this['result'] = $allquery;
    }
    
    
}

function onHandleFormCheck(){
    $title = Input::get('title');
    $sort = Input::get('sort');
    $category = Input::get('category');
    
    $limit = 6;
    $next = 6;
    $sortvar = $category == "SCM" ? 'tb.updated_at' : 'definite_activities_activity.updated_at';
    
    if($sort == "populer"){
        $sortvar = $category == "SCM" ? 'total' : 'definite_activities_like.total';
    }

    $index    = intval(Input::get('index')) + $next;
    $count = 0;
    if($title == ""){
        if($category == "SCM")
        {
            if(Input::get('sort') == "populer"){
            $query = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by ".$sortvar." DESC LIMIT 6 OFFSET ".$index."");
            }else{
                $query = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by sort_top desc, ".$sortvar." ".$sort." LIMIT 6 OFFSET ".$index." ");
                
            }
            $query = collect($query);
        }
        
        if($category == "FMP")
        {
            $query = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_like', 'definite_activities_like.activity_id', '=', 'definite_activities_activity.id')->
        leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('(definite_activities_activity.favorite <> 1 or definite_activities_activity.favorite is null ) AND definite_activities_category.id = 21' )->
                select(DB::raw('IFNULL(definite_activities_like.total,0) as total_likes'), 'definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image');
            if(Input::get('sort') == "populer"){
                $query = $query->orderBy($sortvar, "DESC")->offset($index)->limit($limit)->get();
            }else{
                $query = $query->orderBy('definite_activities_activity.sort_top', "desc")->orderBy($sortvar, $sort)->offset($index)->limit($limit)->get();
            }
           
        }
    
    if(!$query->isEmpty()) $count += 1;
    
    }
    else{
        if($category == "FMP")
        {
            
        $allquery = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_like', 'definite_activities_like.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('(definite_activities_activity.favorite <> 1 or definite_activities_activity.favorite is null ) AND definite_activities_category.id = 21 AND ( definite_activities_activity.title like ? OR definite_activities_activity.description like ?) ', [ '%'.$title.'%', '%'.$title.'%'] )->
            select('definite_activities_like.total as total_likes','definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image');
            
            if($sortvar == 'definite_activities_activity.updated_at'){
                $allquery = $allquery->orderByRaw(" CASE
            WHEN definite_activities_activity.title LIKE '%".$title."%' THEN 1
            WHEN definite_activities_activity.description LIKE '%".$title."%' THEN 2
            ELSE 3
          END, definite_activities_activity.updated_at ".$sort)->offset($index)->limit($limit)->get();
          
            }else{
             $allquery = $allquery->orderBy($sortvar, $sort)->offset($index)->limit($limit)->get();
            }
            
        }else{
            if($sortvar == 'tb.updated_at'){
                $allquery = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.description, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) AND (definite_activities_activity.title like '%".$title."%' OR definite_activities_activity.description like '%".$title."%') group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by CASE
            WHEN title LIKE '%".$title."%' THEN 1
            WHEN description LIKE '%".$title."%' THEN 2
            ELSE 3
          END, ".$sortvar." ".$sort." LIMIT 6 OFFSET ".$index." ");
            }else{
                $allquery = DB::select("SELECT tb.*, IFNULL(definite_activities_like.total,0) as total_likes from (select definite_activities_activity.sort_top, definite_activities_activity.id, definite_activities_activity.updated_at,group_concat(definite_activities_categories_activities.category_id) as groupid, definite_activities_category.slug as slug_category, definite_activities_activity.title, definite_activities_activity.description, definite_activities_activity.slug, definite_activities_activity.featured_image from definite_activities_activity left join definite_activities_categories_activities ON definite_activities_categories_activities.activity_id = definite_activities_activity.id left join definite_activities_category ON definite_activities_category.id = definite_activities_categories_activities.category_id where definite_activities_activity.favorite <> 1 AND (definite_activities_category.id = 22 or definite_activities_category.id = 18) AND (definite_activities_activity.title like '%".$title."%' OR definite_activities_activity.description like '%".$title."%') group by definite_activities_activity.id) tb
                left join definite_activities_like ON tb.id = definite_activities_like.activity_id
                where groupid = '22,18' or groupid = '18,22' and tb.id!=470 order by ".$sortvar." ".$sort." LIMIT 6 OFFSET ".$index." ");
            }
            $allquery = collect($allquery);
            
        }
  
      if(!$allquery->isEmpty()) $count += 1;
    }
    header('Content-Type: application/json');
     $this['result'] = $count;   
}
?>
==
{% partial 'site/banner-festive-2021' %}
{% if category != 'promo' %}
<div class="content-festive">
    <div class="container">
        <div class="section-favorit">

            <h2 class="underline">6 Resep Terfavorit</h2>
    
            <div class="row recipe--list">
                {% for ct in result %}
                    <div class="col-sm-6 col-md-4 ">
                        <a href="/resep-kami/{{slug_category}}/{{ct.slug}}">
                            <div class="recipe--thumb">
                                <div class="item-thumb-img">
                                     <img src="{{ct.featured_image | media}}" class="image-object" alt ="{{ct.title | title}}" />
                                </div>
                                <div class="text-center">
                                    <span class="button bg-orange" >lihat resepnya</span>
                                </div>
                            </div>
                        </a>
                     </div> 
                {%endfor%}
                
            </div>
    
        </div>
        <br>
        <div class="section-all">
        <h2 class="underline">Semua Resep</h2>
        <script>console.log("disini")</script>
        <div class="row">
            <div class="col-md-12">
                <input type="hidden" id="categoryresep" value="{{category}}">
                <input type="hidden" id="sortresep" value="desc">
                <div class="search-container">
                    <input type="text" onfocusout="changeResep()" onkeypress="handle(event)" name="searchresep" id="searchresep" placeholder="Cari Resep Favoritmu" autocomplete="off">
                    <button type="button" id="btn-search"><i class="fa fa-search"></i></button>
                </div>
            </div>
            <div class="col-md-3 col-md-offset-6">
            <label class="select-l">Cari Resep Berdasarkan</label>
            </div>
            <div class="col-md-3">
                <div class="filter-container">
                <div class="sort">
                    <div class="select" onclick="openSort()">
                        <span class="filterValue">Resep Terbaru</span>
                        <div class="dropdown-item">
                            <ul>
                                <li onclick="chooseSort('desc','Resep Terbaru')">Resep Terbaru</li>
                                <li onclick="chooseSort('asc' , 'Resep Terlama')">Resep Terlama</li>
                                <li onclick="chooseSort('populer' , 'Resep Terpopuler')">Resep Terpopuler</li>
                            </ul>
                        </div>
                        <span><i class="fa fa-chevron-down"></i></span>
                    </div>
                </div>
                </div>
            </div>
        </div>
        
        <div class="row recipe--list mt-3 disresult">
            {% for ct in query %}
                <div class="col-sm-6 col-md-4 ">
                    <a href="/resep-kami/{{slug_category}}/{{ct.slug}}">
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ct.featured_image | media}}" class="image-object" alt ="{{ct.title | title}}" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat resepnya</span>
                            </div>
                        </div>
                    </a>
                 </div> 
            {%endfor%}
            
        </div>
        <button class="button gradient-blue" id="btn-loadmore" onclick="search()">Resep Lainnya</button>
        </div>
    </div>
</div>
<script>
var indexresep = 6;
var loadstatus = 0;
function handle(e){
    if(e.keyCode === 13){
        e.preventDefault(); 
         changeResep();
         
    }
}
function openSort(){
    $('.dropdown-item').toggleClass('show')
}
function chooseSort(sort , name){
     $("#sortresep").val(sort)
     $(".filterValue").html(name)
     changeResep();
     $('.dropdown-item').toggleClass('show')
}
function changeResep(){
 indexresep = 0;
 loadstatus = 0;
 $(".disresult").empty();
 search();
}
function search(){
    $(".loading").fadeIn();
    var title = $("#searchresep").val();
    var sort = $("#sortresep").val();
    var category = $("#categoryresep").val();
    
    
    $.request('onHandleForm',                       
    {
        data : {
            title : title,
            sort : sort,
            category : category,
            index : indexresep
        },
        update: {'listresep': '.disresults'},
        beforeUpdate: function(data) { 
            if( data.listresep ){
                $(".noresult").remove();
                
                $(".disresult").append(data.listresep);
                $(".loading").hide();
                
                indexresep += 6;
                
                setTimeout(function(){
                    checkNext();    
                },100);
            }else{
                $("#hasresult").remove();
                
                if($(".disresult .item-thumb").length < 1)
                    $(".disresult").append("<h2 class='noresult'>Tidak ditemukan resep dengan kata pencarian \""+title+"\". Silakan coba pencarian lainnya</h2>");
                $("#btn-loadmore").hide();
                $(".loading").hide();
            }
            
        }
    }); 
}


function checkNext(){
    
    var title = $("#searchresep").val();
    var sort = $("#sortresep").val();
    var category = $("#categoryresep").val();
    console.log(title,sort,category)
    $.request('onHandleFormCheck',                       
    {
        data : {
            title : title,
            sort : sort,
            category : category,
            index : indexresep
        },
        update: {'checkresult': '.disresults1'},
        beforeUpdate: function(data) { 
            
            $("#noresult").remove();
            console.log("checknext",data.checkresult);
            if(data.checkresult != "0"){
                loadstatus = 0;
                $("#btn-loadmore").show();
            }else{
                loadstatus = 1;
                $("#btn-loadmore").hide();
            }
            
        }
    });  
}
</script>

{% else %}
<div class="content-festive">
    <div class="container">
        <div class="row recipe--list mt-3">
           
                <div class="col-sm-6 col-md-4 ">
                    <a href="https://www.frisianflag.com/resep-ramadan-untuk-menangkan-puasamu-dengan-kebaikan-dan-nikmatnya/promo-special-ramadhan" target="_blank">
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-1.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div> 
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://shopee.co.id/frisianflagofficial?shopCollection=245040512#product_list" target="_blank">
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-spesial-shopee.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div>
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://www.tokopedia.com/frisian-flag/etalase/all" target="_blank">
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-ramadan-tokopedia.png '|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div>
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://www.lazada.co.id/shop/frisian-flag/?spm=a2o4j.searchlist.search.4.926240d5gcbeKd&path=promotion-37114-0.htm&sugg=Frisian%2520Flag_3_1&tab=promotion&_keyori=ss&sis_suggestion_click=Frisian%2520Flag%2520Flagship%2520Store%252CFrisian%2520Flag&from=suggest_sis" target="_blank">
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-ramadan-lazada.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div>
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://www.blibli.com/promosi/blm-frisian-flag?appsWebview=true" target="_blank">
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-ramadan-blibli.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div>
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://alfagift.id/b/frisian-flag-11497" target="_blank">
                    <!-- https://c.lazada.co.id/t/c.0xPo6p?intent=false&fallback=true&url=https%3A%2F%2Fwww.lazada.co.id%2Fshop%2Ffrisian-flag-official-store -->
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-diskon-18.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div> 
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://alfagift.id/b/frisian-flag-11497" target="_blank">
                    <!-- https://tokopedia.link/Oj87euyvufb?utm_source=website&utm_medium=brand&utm_campaign=_ff_website__ -->
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-diskon-15.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div>
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://play.google.com/store/apps/details?id=com.midi.kriing&hl=id&gl=US" target="_blank">
                    <!-- https://tokopedia.link/Oj87euyvufb?utm_source=website&utm_medium=brand&utm_campaign=_ff_website__ -->
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-scm-alfamidi.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div> 
                 <div class="col-sm-6 col-md-4 ">
                    <a href="https://play.google.com/store/apps/details?id=com.midi.kriing&hl=id&gl=US" target="_blank">
                    <!-- https://tokopedia.link/Oj87euyvufb?utm_source=website&utm_medium=brand&utm_campaign=_ff_website__ -->
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-fmp-alfamidi.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div> 
                 <div class="col-sm-6 col-md-4 ">
                    <a href="http://www.klikindomaret.com/page/frisian-flag-official-store" target="_blank">
                    <!-- https://tokopedia.link/Oj87euyvufb?utm_source=website&utm_medium=brand&utm_campaign=_ff_website__ -->
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-scm-indomaret.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div> 
                 <div class="col-sm-6 col-md-4 ">
                    <a href="http://www.klikindomaret.com/page/frisian-flag-official-store" target="_blank">
                    <!-- https://tokopedia.link/Oj87euyvufb?utm_source=website&utm_medium=brand&utm_campaign=_ff_website__ -->
                        <div class="recipe--thumb">
                            <div class="item-thumb-img">
                                 <img src="{{ 'ramadan-2023/promo-fmp-indomaret.png'|media}}" class="image-object" alt ="Promo" />
                            </div>
                            <div class="text-center">
                                <span class="button bg-orange" >lihat promonya</span>
                            </div>
                        </div>
                    </a>
                 </div> 
                 
        </div>
    </div>
</div>
{% endif %}
{% partial 'festive-sticky-desktop' %}
{% partial 'site/footer-without-login' %}