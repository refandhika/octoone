title = "return-love"
url = "/return-love"
is_hidden = 0

[viewBag]
localeUrl[en] = "/return-love"
==
<?php
function onStart(){
    $id = Input::get('id');
    
    $cookie = Cookie::get('october_session');
    
     $click = Input::get('clicklike') == "1" ? 'ok' : '';
     if($click == "ok"){
         
        
         $check_like = DB::table('definite_activities_like_history')->where('activity_id', '=', $id)->where('cookies', $cookie)->exists();
        if($check_like){
            DB::table('definite_activities_like_history')->where('activity_id', '=', $id)->where('cookies', $cookie)->delete();
        }else{
            DB::table('definite_activities_like_history')->insert([
                'activity_id' => $id,
                'cookies' => $cookie,
                'created_at' => date("Y-m-d h:i:s")
            ]);
    
        }
        
        $total = DB::table('definite_activities_like_history')->where('activity_id', '=', $id)->count();
        DB::table('definite_activities_like')->
        updateOrInsert(
            ['activity_id' => $id],
            ['total' => $total]
        );
     }
    $total_like = DB::table('definite_activities_like')->select('total')->where('activity_id', '=', $id)->get();
    if($total_like->isEmpty()){
          $total_like = 0;
      }else{
          $total_like = $total_like[0]->total;
      }
      $this['total_like'] = $total_like;
      $check_like = DB::table('definite_activities_like_history')->where('activity_id', '=', $id)->where('cookies', $cookie)->exists();
      
      header('Content-Type: application/json');
      $this['user_like'] = $check_like ? "true" : "false";
}
?>
==
{"value":{{ user_like }},"count":{{ total_like }}}