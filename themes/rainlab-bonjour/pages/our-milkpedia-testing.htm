title = "Our Milkpedia Testing"
url = "/amp/milkpedia-testing/:category-slug?/:slug"
layout = "basic-amp"
is_hidden = 0

[builderDetails]
modelClass = "Definite\Milkpedia\Models\Milkpedia"
identifierValue = "{{ :slug }}"
modelKeyColumn = "slug"
displayColumn = "title"
notFoundMessage = "Record not found"
==
<?php
use \Definite\Milkpedia\Models\Category as Category;

function onEnd() {
    
   $param_slug    = $this->param('category-slug');
   $cmsController = new Cms\Classes\Controller;   
   
   if(!$this->page->components["builderDetails"]->record){
    
        return Response::make( $cmsController->render("/404"), 404);
   
    }
   
    $category_slug = $this->page->components["builderDetails"]->record->categories->first();
    $slug          = $this->page->components["builderDetails"]->record->attributes["slug"];
    $pages = Definite\Milkpedia\Models\Milkpedia::where('slug',$slug)->get()->first();
    $link_e_commerce = $pages->products->link_e_commerce;
  $array = [];
  foreach($link_e_commerce as $item){
    if(strpos($item['link'], 'lazada') > 0){
        array_push($array , 'Lazada');
    } elseif(strpos($item['link'], 'blibli') > 0) {
        array_push($array , 'Blibli');
    } elseif(strpos($item['link'], 'jd.id') > 0) {
        array_push($array , 'jd.id');
    } elseif(strpos($item['link'], 'alfagift') > 0) {
        array_push($array , 'Alfagift');
    } elseif(strpos($item['link'], 'klikindomaret') > 0) {
        array_push($array , 'Klikindomaret');
    } elseif(strpos($item['link'], 'tokopedia') > 0) {
        array_push($array , 'Tokopedia');
    } elseif(strpos($item['link'], 'shopee') > 0) {
        array_push($array , 'Shopee');
    } elseif(strpos($item['link'], 'bukalapak') > 0) {
        array_push($array , 'Bukalapak');
    }
  }
  $this['link_e_commerce'] = $array;
    if($param_slug == 'default')
    {
        return redirect()->to(url('/milkpedia/'.$category_slug->slug.'/'.$slug));
    }
    
    if(!Category::where('slug',$param_slug)->first()){
        return Response::make( $cmsController->render("/404"), 404);
    }  

      // get the post component
    $_title      = $this->page->components["builderDetails"]->record->attributes["title"];
    $_meta_title = $this->page->components["builderDetails"]->record->attributes["meta_title"];
    
    if($_meta_title){
             $this->page->title      = $_meta_title;
             $this->page->meta_title = $_meta_title;
        }
    else{
             $this->page->title = $_title;
        }    
    $_meta_description = $this->page->components["builderDetails"]->record->attributes["meta_description"] ?? NULL;
    $_meta_keywords = $this->page->components["builderDetails"]->record->attributes["meta_keywords"] ?? NULL;
    
    $this->page->meta_description = $_meta_description;
    $this->page->meta_keywords = $_meta_keywords;

    $_title_en = $this->page->components["builderDetails"]->record->attributes["title_en"] ?? NULL;
    $_meta_description_en = $this->page->components["builderDetails"]->record->attributes["meta_description_en"] ?? NULL;
    $_meta_keywords_en = $this->page->components["builderDetails"]->record->attributes["meta_keywords_en"] ?? NULL;
    $this->page->title_en = $_title_en;
    $this->page->meta_title_en = $this->page->components["builderDetails"]->record->attributes["meta_title_en"] ?? NULL;
    $this->page->meta_description_en = $_meta_description_en;
    $this->page->meta_keywords_en = $_meta_keywords_en;

    $this->page->category_slug = $this->param('category-slug');
}
?>
==
{% set record = builderDetails.record %}
{% set displayColumn = builderDetails.displayColumn %}
{% set notFoundMessage = builderDetails.notFoundMessage %}

{% put head_scripts %}
<script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script>
<script async custom-element="amp-lightbox" src="https://cdn.ampproject.org/v0/amp-lightbox-0.1.js"></script>
<!-- <script async custom-element="amp-script" src="https://cdn.ampproject.org/v0/amp-script-0.1.js"></script>
<meta name="amp-script-src" content="sha384-ot_z97D7PtRFGjQCMQwDypgxjqlGIttSgp-mtRloaxbsO-oHwUCDi9sLkTrJRgAG"> -->
{% endput %}

{% put styles %}
        .style3{
            background-color: #F6902A;
        }
        .style2{
            background-color:#0F4D9A;  
            margin: 20px 0;
        }
        
        .ecomdetails-title {
        font-size: 20px;
        margin-bottom: 10px;
        color: white;
        }
        .light-blue{
            color: #0D62A7
         }
        .wrapper-ecom-detail{
            align-self: center;
            height: 175px;
            width: 100%;
            position: relative;
            display: flex;
            align-items: center;
            border-radius: 15px;
        }
        .wrapper-ecom-detail img{
            object-fit: contain;
            border-radius: 10px;
            
        }
        
        .wrapper-ecom-detail .ecom-productbanner{
        margin: 10px;
        background: white;
        border-radius: 10px;
        }
        
        .wrapper-ecom-detail .ecom-productbanner img{
            object-fit: contain;    
        }
        
        .wrapper-ecom-detail .ecom-productdetail{
            margin-left: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-self: center;
        }
        
        .wrapper-ecom-detail .ecom-productdetail p{
            margin: unset; 
            color: #0D62A6;
        }
        
        .wrapper-ecom-detail .ecom-productdetail .white{
            color: white;
            }
        
        .wrapper-ecom-detail .ecom-productdetail h4{
        color: white;
        font-size: 14px;
        margin: 10px 0;
        color: #0f4d9a;
        text-align: left;
        }
        
        .wrapper-ecom-detail .ecom-productdetail .white{
            color: white;
            }
        
        
        .wrapper-ecom-detail .ecom-productdetail img{
            objet-fit: contain;    
        }

        .op-1{
            opacity: 1;    
        }
        .lightbox {
          background: rgba(0,0,0,0.8);
          width: 100%;
          height: 100%;
          position: absolute;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
        }
        .lightbox h1 {
          color: white;
        }
        .amp-modal-wrapper-ecom{
            width: 90%;
            margin: 0 auto;
            height: auto;
            background-color: #0f4d9a;
            border-radius: 25px;
            position: relative;
            padding: 3.5vh 0;
        }
        .amp-modal-wrapper-ecom .amp-modal-ecom-title{
            font-size: 5vw;
            text-align: center;
            color: #fff;
            font-weight: 600;
            margin: 10px 0;
        }

        .amp-modal-wrapper-ecom .amp-modal-ecom-list{
            display: flex;
            flex-direction: column;
            width: 90%;
            margin: 0 auto;
        }
        .amp-modal-wrapper-ecom .amp-modal-ecom-list .amp-modal-ecom-btn-details{
            width: 85%;
            padding: 2.5vw 0;
            background-color: transparent;
            border: 1px solid #fff;
            margin: 2.5vw auto;
            color: #fff;
            text-decoration: none;
            text-align: center;
            font-size: 5vw;
            transition: 0.3s;
        }
        .amp-modal-wrapper-ecom .amp-modal-ecom-list .amp-modal-ecom-btn:hover{
            font-size: 7.5vw;
            background-color: #166ad1;
        }

        .lightbox .close{
            position: absolute;
            top: -10px;
            right: -10px;
            background: #fff;
            border: 1px solid #000;
            color: #000;
            font-size: 3.5vw;
            border-radius: 50px;
            width: 40px;
            height: 40px;
            font-weight: 700;
            outline: none;
        }
        
        .wrapper-ecom{
            width: 90%;
            margin: 0 auto;
            height: 125px;
            background: url(/storage/app/media/Banner/ecommerce-banner.png);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: 20% 50%;
            margin-bottom: 20px;
            border-radius: 10px;
        }
        .wrapper-ecom .wrapper-ecom-2{
            width: 50%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;    
            margin-left: 20px;
        }
        .wrapper-ecom .wrapper-ecom-2 .ecom-title{
            margin-bottom: 10px;
            color: #0f4d9a;
        }
        .white{
            color: white;    
        }
{% endput %}



{% if record %}
    <div class="cover">
      {% if record.slug == 'resep-mudah-3-kue-istimewa-penghangat-suasana-hari-raya' %}
        <amp-img 
            src="{{ 'assets/img/product-header-mobile.png'|theme }}"
            width="50"
            height="50"
            layout="responsive"
            alt="Product Header Mobile">
        </amp-img>
      {% else %}
        <amp-img 
            src="{{ 'assets/img/95-TAHUN-FF_mobile-banner.jpg'|theme }}"
            width="50"
            height="50"
            layout="responsive"
            alt="Banner 95 Tahun Frisian Flag">
        </amp-img>
      {% endif %}
    </div>

    <div class="breadcrumb">
        <a href="{{ url('/') }}">{{ 'beranda'|_ }}</a> /
        <a href="#">Milkpedia</a> / 
        <a href="{{ 'our-milkpedia'|page({ slug: record.categories.first.slug }) }}">{{ trans_pick(record.categories.first, 'title') }}</a> / 
        <a href="{{ 'our-milkpedia-single-amp'|page({ slug: record.slug }) }}">{{ trans_pick(record, 'title') }}</a>
    </div>
    
    <div class="detail_text">
  <!--   <amp-script layout="container" script="hello-world" class="sample" data-ampdevmode> -->
        <div class="category">{{ trans_pick(record.categories.first, 'title') }}</div>
        <div class="date">{{ record.created_at.format('d M Y') }}</div>
        <h1>{{ trans_pick(record, 'title') }}</h1>
        {% if record.featured_image %}
        <div class="img_detail">

          <amp-img 
            src="https://www.frisianflag.com/{{ record.featured_image|media }}"
            width="360"
            height="280"
            layout="responsive"
            alt="{{record.title}}">
          </amp-img>

        </div>
        {% endif %}
        <div class="text">
          {{ trans_pick(record, 'content')|convertAMPImg|raw }}
        </div>
       
        {% if record.products %}
              <div class="wrapper-ecom-detail">
                    <div class="ecom-productbanner">
                        <amp-img  src="{{ record.products.featured_image | media }}" alt="{{ trans_pick(record, 'title') }}" width="150" height="125" class="img-ecom"/>
                    </div>
                    <div class="ecom-productdetail">
                       <p>Yang anda perlukan : </p>
                       <h4>{{ record.products.title }}</h4>
                       <amp-img src="{{ 'button-ecommerce.png' | media }}" role="button" tabindex="0" width="100" height="40" id="buy" class="buy" on="tap:ecomdetails-lightbox"/>
                   </div>
              </div>
              
                <div class="wrapper-ecom-detail style2" style="display : none">
                    <div class="ecom-productbanner">
                        <amp-img  src="{{ record.products.featured_image | media }}" alt="{{ trans_pick(record, 'title') }}" width="150" height="125" class="img-ecom"/>
                    </div>
                    <div class="ecom-productdetail">
                       <p class="white">Yang anda perlukan : </p>
                       <h4 class="white">{{ record.products.title }}</h4>
                       <amp-img src="/storage/app/media/button-ecommerce-yellow.png" role="button" tabindex="0" width="100" height="40" id="buy" class="buy" on="tap:ecomdetails-lightbox"/>
                   </div>
              </div>
              
                <div class="wrapper-ecom-detail style3" style="display : none">
                    <div class="ecom-productbanner">
                        <amp-img  src="{{ record.products.featured_image | media }}" alt="{{ trans_pick(record, 'title') }}" width="150" height="125" class="img-ecom"/>
                    </div>
                    <div class="ecom-productdetail">
                       <p class="white">Yang anda perlukan : </p>
                       <h4 class="white">{{ record.products.title }}</h4>
                       <amp-img src="{{ 'button-ecommerce.png' | media }}" role="button" tabindex="0" width="100" height="40" id="buy" class="buy" on="tap:ecomdetails-lightbox"/>
                   </div>
              </div>
        {% endif %}
<!-- <div class="wrapper-ecom" id="wrapper-ecom">
    <div class="wrapper-ecom-2">
        <h4 class="ecom-title">Sedia Frisian Flag Pilihanmu Sekarang</h4>
        <amp-img  src="{{ 'button-ecommerce.png' | media }}" height="25" width="100" on="tap:ecom-lightbox" role="button" tabindex="0"/>
    </div>
</div> -->

<!-- <button id="hello-inline">Say hello!</button>

</amp-script> -->

<!-- <script id="hello-world" type="text/plain" target="amp-script">
  
  
  const button = document.getElementById('hello-inline');
  
  function test () {
      button.innerText = 'test'
  }
  console.log(test)
  console.log(test())
  
  button.addEventListener('click', () => {
      console.log("3")
      const h1 = document.createElement('h1');
      h1.textContent = 'Hello World!';
      document.body.appendChild(h1);
  });
  
</script> -->


        
  <div class="share center mb-10">
        
        <p class="title-share">{{'Share This Entry'}}</p>
        
              <amp-social-share width="35"
              height="35" class="rounded" type="facebook"
              data-param-app_id="872847836388420"></amp-social-share>
              <amp-social-share width="35"
              height="35" class="rounded" type="twitter"></amp-social-share>
              <amp-social-share width="35"
              height="35" class="rounded" type="whatsapp"></amp-social-share>
              <amp-social-share width="35"
              height="35" class="rounded" type="line"></amp-social-share>
    </div>
              
    </div>
    

<div>    
   <!--  <amp-script layout="container" script="ecommodal-details" class="op-1"> -->
<!--     {% if record.products %}
  <div class="wrapper-ecom-detail">
        <div class="ecom-productbanner">
            <amp-img  src="{{ record.products.featured_image | media }}" alt="{{ trans_pick(record, 'title') }}" width="150" height="200"/>
        </div>
        <div class="ecom-productdetail">
           <p>Yang anda perlukan : </p>
           <h4>{{ record.products.title }}</h4>
           <amp-img src="{{ 'button-ecommerce.png' | media }}" role="button" tabindex="0" width="100" height="40" id="buy" class="buy" on="tap:ecomdetails-lightbox"/>
       </div>
  </div>
{% endif %} -->
    
        <!-- modal -->
    <amp-lightbox id="ecomdetails-lightbox" layout="nodisplay">
     
      <div class="lightbox" role="button" tabindex="0">
          <div class="amp-modal-wrapper-ecom">
              <h4 class="ecomdetails-title">Temukan Produk Kami di:</h4>
              <div class="amp-modal-ecom-list">
                {% for shop in record.products.link_e_commerce %}
                    <a class="amp-modal-ecom-btn-details" href="{{ shop.link }}" target="_blank">
                        {{ link_e_commerce[ loop.index - 1] }}
                    </a>
                {% endfor %}
                
              </div>
              <button class="close" on="tap:ecomdetails-lightbox.close">X</button>
          </div>
      </div>
    </amp-lightbox> 
       <!-- </amp-script> -->
       
      <!--  <script id="ecommodal-details" type="text/plain" target="amp-script">
          var btn = document.getElementById("buy");
          btn.addEventListener('click', () => { 
              console.log("test")
               var link = document.querySelectorAll(".amp-modal-ecom-btn-details");
          
          for( var i = 0; i < link.length; i++ ) {
               if(link[i].href.indexOf('lazada') >= 0){
                   link[i].textContent = 'lazada';
               } else if(link[i].href.indexOf('jd.id') >= 0){
                   link[i].text = 'jd.id';
               } else if(link[i].href.indexOf('alfagift') >= 0){
                   link[i].textContent = 'Alfamart';
               } else if(link[i].href.indexOf('blibli') >= 0){
                 link[i].text = 'blibli';
               } else if(link[i].href.indexOf('klikindomaret') >= 0){
                 link[i].text = 'klikindomaret';
               } else if(link[i].href.indexOf('tokopedia') >= 0){
                 link[i].outerText = 'tokopedia';
               } else if(link[i].href.indexOf('shopee') >= 0){
                 link[i].innerText = 'shopee';
               } else if(link[i].href.indexOf('bukalapak') >= 0){
                 link[i].textContent = 'bukalapak';
               }   
           }      
          })
      </script> -->
</div>

    {% set related = record.related %}
    {% if related %}
      <!-- s:artikel Terkait -->
      <div class="title_page">{{ 'artikel-terkait'|_ }}</div>
      {% for milkpedia in related %}
        <div class="list2">
          <div class="img">
           {%  if milkpedia.featured_image %}
            <amp-img 
                src="{{ milkpedia.featured_image| media}}"
                width="160"
                height="140"
                layout="responsive"
                alt="an image">
            </amp-img>
            {% else %}
              <amp-img 
                src="{{ 'image_not_available_14.png'| media}}"
                width="160"
                height="140"
                layout="responsive"
                alt="an image">
            </amp-img>
            {% endif %}
          </div>
          <div class="text">
            <div class="info">
              <span class="label">Milkpedia</span>
            </div>
            <a href="{{ 'our-milkpedia-amp-single'|page({
                          'categories-slug': milkpedia.category.slug,
                          'slug': milkpedia.slug
                      }) }}" target="_self"><h3>{{ trans_pick(milkpedia, 'title') }}</h3></a>
          </div>
          <div class="clearfix"></div>
        </div>
      {% endfor %}
    {% endif %}
    <!-- e:artikel Terkait -->
{% else %}
    {% partial '404' %}
{% endif %}