title = "Testing Infinity Scroll"
url = "/amp/testing/resep-kami"
is_hidden = 0

[viewBag]
localeUrl[en] = "/testing-fiki"
==
<?php
function onStart(){
    $title = Input::get('q') ? Input::get('q') : "";
    $sort = "desc";
    //$this->page->title = "Resep Nikmat Praktis Frisian Flag #diRumahAja";
    //$category = Input::get('category') ? strtoupper(Input::get('category')) : "all";
    $category = "all";
    $index    = 0;
    $this['title'] = $title;
    $this['category'] = "all";
    $limit = 2;
    if($category != "all"){
        $limit = 6;
    }
    if($category == "all" || $category == "SCM")
    $scm = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('definite_activities_category.id = ? AND ( definite_activities_activity.title like ? OR definite_activities_activity.bahan like ?)', [ 22, '%'.$title.'%', '%'.$title.'%' ] )->
            select('definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image')->orderBy('definite_activities_activity.updated_at', $sort)->offset($index)->limit($limit)->get();
    
    if($category == "all" || $category == "RTD")
    $rtd = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('definite_activities_category.id = ? AND ( definite_activities_activity.title like ? OR definite_activities_activity.bahan like ?)', [ 19, '%'.$title.'%', '%'.$title.'%' ] )->
            select('definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image')->orderBy('definite_activities_activity.updated_at', $sort)->offset($index)->limit($limit)->get();
    
    if($category == "all" || $category == "FMP")
    $fmp = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('definite_activities_category.id = ? AND ( definite_activities_activity.title like ? OR definite_activities_activity.bahan like ?)', [ 21, '%'.$title.'%', '%'.$title.'%' ] )->
            select('definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image')->orderBy('definite_activities_activity.updated_at', $sort)->offset($index)->limit($limit)->get();
    
    
    if($category == "SCM"){
        $this['result'] = $scm;
    }
    elseif($category == "RTD")
    {
        $this['result'] = $rtd;
    }
    elseif($category == "FMP")
    {
        $this['result'] = $fmp;
    }else{
        $collection = collect($rtd);
        $merged     = $collection->merge($scm)->merge($fmp);
        $this['result'] = $merged;
    }
        
}
?>
==
{% partial 'site/header-amp-banner1' %}

<div class="body-1">
    <div class="disresult row">

	 
      <amp-state id="photos" src="https://www.frisianflag.com/return-json?title={{title}}&sort=desc&category={{ category }}&index=0"></amp-state>
      <amp-state id="product">
        <script type="application/json">
        {
            "title": "{{ title }}",
            "titletemp": "{{ title }}",
            "pageIndex": {{title != '' ? 6 : 2 }},
            "sort": "desc",
            "category":"{{ category }}",
            "checknext":1,
            "moreItemsPageIndex": 2,
            "hasMorePages": true,
            "length": {{ result.count }},
            "searchvalue" : "{{ title }}"
        }
        </script>
      </amp-state>
             <form method="GET" action="https://www.frisianflag.com/amp/resep-kami" target="_top">

            <input class="search-amp-resep" type="search" name="q" placeholder="Ketik Resep Atau Bahan">
            <input type="submit" value="Search" style="display: none;">
            
        </form>
    <form id="formdata" method="GET" action="https://www.frisianflag.com/return-json" action-xhr="https://www.frisianflag.com/return-json" target="_top"> 
    <input type="hidden" name="title" value="{{ title }}" [value]="product.title">
    <input type="hidden" name="sort" value="desc" [value]="product.sort">
    <input type="hidden" name="category" value="all" [value]="product.category">
    <input type="hidden" name="index" value="0">
    <div style="display: flex;">
        <h1 class="title-filter">Resep Pilihan  Hari ini</h1>
        <select class="option-b" name="sort"on="change:AMP.setState({
                product:{
                    pageIndex: product.category != 'all' ? 6 : 2, sort: event.value 
                },
                photos: {
                    items: 'https://www.frisianflag.com/return-json?title={{title}}&sort='+event.value+'&category={{ category }}&index=0'
                }
            })">
                    
                    <option value="desc" [selected]="product.sort == 'desc'">Terbaru</option>
                    <option value="asc" [selected]="product.sort == 'asc'">Terlama</option>
                    <option value="populer" [selected]="product.sort == 'populer'">Terpopuler</option>
                    <!-- <option value="FMP" [selected]="product.category == 'FMP'">FMP</option> -->
        </select>
    </div>
</form>
    <!-- <div style="display: flex;">    
        <button class="filter-icon"  on="tap:AMP.setState({ filterbottom: !filterbottom })"></button>
    </div>
      -->
    
    <h2 {{result.count > 0 ? 'hidden' : ''}} [hidden]="product.length > 0" class="search-result">Tidak ditemukan resep dengan kata pencarian "<span [text]="product.length > 0 ? '' : product.searchvalue">{{title}}</span>". Silakan coba pencarian lainnya</h2>
    <amp-list src="https://www.frisianflag.com/return-json?title={{title}}&sort=desc&category={{ category }}&index=0" [src]="photos.items" binding="refresh" load-more="auto" load-more-bookmark="nextload" layout="fixed-height" width="auto" height="600" [height]="photos.items.length * 100 + 12">
    <template type="amp-mustache">
      <div class="list-item">
      <div class="main__recipe">
      {% verbatim %}
      <div class="recipe-thumb">
      <a href="/testing/resep-kami/{{slug_category}}/{{slug}}#main-scroll">
      <amp-img class="img-list" src="/storage/app/media/{{featured_image}}" width="100" height="100" layout="responsive" alt="{{title}}">
        </amp-img>
        </a>
        
                <div class="total--likes" hidden [hidden]="product.sort != 'populer'">
                    {{ total_likes }} 
                    <amp-img style="vertical-align:middle;" src="/storage/app/media/resep-kami/heart-icon.svg" width="15" height="15" layout="fixed">
        </amp-img>
                </div>
           
        </div>
        <div class="div-1"><a href="/testing/resep-kami/{{slug_category}}/{{slug}}#main-scroll" class="button gradient-orange ">Lihat Resepnya</a></div>
        {% endverbatim %}
        
      </div>
      </div>
    </template>
  </amp-list>
<form id="formdataloadmore" method="GET" action="https://www.frisianflag.com/return-json" action-xhr="https://www.frisianflag.com/return-json" target="_top" on="submit-success: AMP.setState({
              photos: {
                items: photos.items.concat(event.response.items)
              },
              product: {
                  pageIndex : product.title != '' ? product.pageIndex + 6 : product.pageIndex + 2
              }
            });">
        <input type="hidden" name="title" value="{{ title }}" [value]="product.title">
        <input type="hidden" name="sort" value="desc" [value]="product.sort">
        <input type="hidden" name="category" value="{{ category }}" [value]="product.category">
        <input type="hidden" name="index" value="2" [value]="product.pageIndex">
        <!-- <input class="load-more"{{result.count > 0 ? '' : 'hidden'}} id="btnloadmore" [hidden]="product.checknext == 0" type="submit" value="Resep Lainnya" on="tap:formchecknext.submit" tabindex="0" role="button"> -->

</form>

<form id="formchecknext" method="GET" action="https://www.frisianflag.com/recipe-check-next" action-xhr="https://www.frisianflag.com/recipe-check-next" target="_top" on="submit-success: AMP.setState({
              product: {
                checknext: event.response.items
              }
            });">
        <input type="hidden" name="title" value="{{ title }}" [value]="product.title">
        <input type="hidden" name="sort" value="desc" [value]="product.sort">
        <input type="hidden" name="category" value="{{ category }}" [value]="product.category">
        <input type="hidden" name="index" value="{{title != '' ? 6 : 2 }}" [value]="product.pageIndex">
        <input type="text" name="test" value="2" [value]="product.checknext" style="display:none"> 
        <input class="load-more" type="submit" value="Check Next" style="display:none">
</form>      
    <!--<button class="category1 fixed" on="tap:AMP.setState({product:{ pageIndex: product.category != 'all' ? 6 : 2, category: 'RTD' }}),formdata.submit, formchecknext.submit"></button>
    <button class="category2 fixed" on="tap:AMP.setState({product:{ pageIndex: product.category != 'all' ? 6 : 2, category: 'SCM' }}),formdata.submit, formchecknext.submit"></button>
    <button class="category3 fixed" on="tap:AMP.setState({product:{ pageIndex: product.category != 'all' ? 6 : 2, category: 'FMP' }}),formdata.submit, formchecknext.submit"></button>-->
    <button class="category1 fixed" on="tap:AMP.navigateTo(url=/testing/resep-kami/resep-dengan-susu-cair)"></button>
	 <button class="category2 fixed" on="tap:AMP.navigateTo(url=/testing/resep-kami/resep-dengan-kental-manis)"></button>
	 <button class="category3 fixed" on="tap:AMP.navigateTo(url=/testing/resep-kami/resep-dengan-susu-bubuk)"></button>
	 
    </div>	 

</div>
{% partial 'site/footer-amp' %}