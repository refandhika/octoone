title = "return-json-cokelat"
url = "/return-json-cokelat"
is_hidden = 0

[viewBag]
localeUrl[en] = "/return-json-cokelat"
==
<?php
function onStart(){
    $title = Input::get('title');
    $sort = Input::get('sort');
    $category = Input::get('category');
    $index    = intval(Input::get('index'));
    
    $limit = 6;
    
    if(strtolower($title) == 'kangen' || strtolower($title) == 'resep kangen'){
        $categoryId = 24;
        $title = '';
    }elseif(strtolower($title) == 'bosan' || strtolower($title) == 'resep bosan'){
        $categoryId = 25;
        $title = '';
    }elseif(strtolower($title) == 'lelah' || strtolower($title) == 'resep lelah'){
        $categoryId = 26;
        $title = '';
    }elseif(strtolower($title) == 'senang' || strtolower($title) == 'resep senang'){
        $categoryId = 27;
        $title = '';
    }elseif(strtolower($title) == 'patah hati' || strtolower($title) == 'resep patah hati'){
        $categoryId = 28;
        $title = '';
    }elseif(strtolower($title) == 'galau' || strtolower($title) == 'resep galau'){
        $categoryId = 29;
        $title = '';
    }elseif(strtolower($title) == 'sedih' || strtolower($title) == 'resep sedih'){
        $categoryId = 30;
        $title = '';
    } else {    
        $categoryId = 20;
    }
    
    $query = Definite\Activities\Models\Activity::leftJoin('definite_activities_categories_activities', 'definite_activities_categories_activities.activity_id', '=', 'definite_activities_activity.id')->
    leftJoin('definite_activities_category', 'definite_activities_category.id', '=', 'definite_activities_categories_activities.category_id')->whereRaw('definite_activities_category.id = ? AND ( definite_activities_activity.title like ? OR definite_activities_activity.description like ?)', [ $categoryId, '%'.$title.'%', '%'.$title.'%' ] )->
            select('definite_activities_category.slug as slug_category','definite_activities_activity.title', 'definite_activities_activity.slug', 'definite_activities_activity.featured_image')->orderBy('definite_activities_activity.updated_at', $sort)->offset($index)->limit($limit)->get();
    
    header('Content-Type: application/json');
    
    
    $this['result'] = $query;
        
}
?>
==
{"items":{{ result | raw  }}}