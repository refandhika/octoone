title = "TestPage"
url = "/amp/perusahaan-kami-test/berita-test/"
layout = "basic2-amp"
is_hidden = 0

[viewBag]
localeUrl[en] = "/testpage"

[builderList]
modelClass = "Definite\News\Models\News"
scope = "scopeIndex"
scopeValue = "{{ :scope }}"
displayColumn = "title"
noRecordsMessage = "No records found"
detailsPage = "-"
detailsUrlParameter = "id"
recordsPerPage = 10
pageNumber = "{{ /p= }}"

[builderDetails]
modelClass = "Definite\News\Models\Categories"
identifierValue = "{{ amp/perusahaan-kami-test/berita-test/ }}"
modelKeyColumn = "id"
displayColumn = "title"
notFoundMessage = "Record not found"

[NewsList]
==
<?php
function onEnd() {
  
  // get the post component
  $this->page->title = "Berita";
  $this->page->title_en = "News";

  $records = $this->page->components["builderList"]->records;
   if($records->currentPage() > $records->lastPage()){
            $cmsController = new Cms\Classes\Controller;
            return Response::make( $cmsController->render("/404"), 404);
    }
      $totalku = $this->page->components["NewsList"]->total;
        $build = $this->page->components["builderDetails"]->record;
    $total = $this->page->components["NewsList"]->total;
   $currentPage =  $this->page->p = Input::get('p', 1);
    

   $products =  Definite\News\Models\News::offset(($currentPage - 1) * 10)->orderBy('created_at', 'desc')->limit(10)->get();
 
   $test =  Definite\News\Models\News::paginate(15);
      // $products = Definite\News\Models\News::where('pages', 0)->limit(3)->offset((2) * 1)->get();
    $this['totalnya'] =  $products;
    $count = count($products);
    if($count === 0) {
                    $cmsController = new Cms\Classes\Controller;
            return Response::make( $cmsController->render("/404"), 404);
        }
    $this['lengthProduct'] = $count;

    // pagination
    $this->page->p = Input::get('p', 1);
    if( ! is_numeric($this->page->p)){
      $this->page->p = 1;
    }else if($this->page->p < 1){
      $this->page->p = 1;
    }

    $num_pgn = 5;
    $space_pgn = 2;

    $this->page->total_page = $total / 10;
    $this->page->total_page = (int) ceil($this->page->total_page);
  
    $this->page->max_p = $this->page->p <= $space_pgn ? $num_pgn : $this->page->p + $space_pgn;

  if( $this->page->max_p > $records->lastPage() ){
    $this->page->max_p = $records->lastPage();
  }

  $this->page->min_p = $this->page->max_p - ($num_pgn - 1);
  if( $this->page->min_p < 1 ) $this->page->min_p = 1;
  
  
  
}
?>
==
{% set records = builderList.records %}
{% set displayColumn = builderList.displayColumn %}
{% set noRecordsMessage = builderList.noRecordsMessage %}
{% set detailsKeyColumn = builderList.detailsKeyColumn %}
{% set detailsUrlParameter = builderList.detailsUrlParameter %}
{% set record = builderDetails.record %}

{% put head_scripts %}
<script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script>
{% endput %}


<div class="cover">
  <amp-img
    src="{{ 'assets/img/95-TAHUN-FF_mobile-banner.jpg'|theme }}"
    srcset="{{ 'assets/img/95-TAHUN-FF_mobile-banner.jpg'|theme }} 640w,
    {{ 'assets/img/95-TAHUN-FF_mobile-banner.jpg'|theme }} 320w"
    width="50"
    height="50"
    layout="responsive"
    alt="an image">
  </amp-img>
</div>
<amp-accordion class="title_home">
  <section>
    <h4 class="arrow_down"><a href="#" target="_self">{{'news'|_}}</a></h4>
    <p>
      <a href="{{'about-us'|page}}" target="_self">{{'tentang-kami'|_}}</a>
      <a href="{{'news-amp'|page}}" target="_self">{{'berita'|_}}</a>
      <a href="{{'galeri-amp'|page}}" target="_self">{{'galeri-foto'|_}}</a>
      <a href="{{'press-release-amp'|page}}" target="_self">{{'siaran-pers'|_}}</a>
      <a href="{{'our-purposes-amp'|page}}" target="_self">{{'tujuan-kami'|_}}</a>
    </p>
  </section>
</amp-accordion>
<div class="breadcrumb">
  <a href="{{ 'home'|page }}">{{'beranda'|_}}</a> /
  <a href="#">{{'berita'|_}}</a>
</div>
<div class="detail_text">
  <h1>{{'berita'|_}}</h1>
  <form action-xhr="#" method="post" target="_blank" class="search_plain">
    <input type="text" placeholder="Search">
  </form>
  <br>
  <amp-accordion class="title_home">
      <h4 class="arrow_down"><a href="#" target="_self">All</a></h4>
    <section>
      <p>
        <a href="{{url('news-amp'|page ({"page":null})) }}" target="_self">All</a>
        {% for years in records.first.year  %}
        <a href="{{url('news-archive-amp'|page ({"slug":years.published_date, "page":null})) }}" target="_self">{{ years.published_date }}</a>
        {% endfor %}
      </p>
    </section>
  </amp-accordion>
</div>


    products
{% for newsnew in totalnya %}
{{ newsnew.id }}
<div class="list2 list2b">
  <div class="img">
    <amp-img
      src="{{newsnew.featured_image| mediathumb_resize('width', 100, 80) }}"
      srcset="{{newsnew.featured_image| mediathumb_resize('width', 640, 80) }} 640w,
      {{newsnew.featured_image| mediathumb_resize('width', 320, 80) }} 320w"
      width="160"
      height="90"
      layout="responsive"
      alt="an image">
    </amp-img>
  </div>
  
  
  <div class="text">
    <div class="info">
      {{newsnew.published_date|date('M d, Y')}}
    </div>
    <a href="{{ 'newsnew-single-amp'|page({'slug': newsnew.slug}) }}" target="_self"><h3 attr-test="test">{{ trans_pick(newsnew, 'title') }}</h3></a>
  </div>
  <div class="clearfix"></div>
</div>

{% endfor %}
<!-- e:section list -->
<!-- s:paging -->
    <div class="stylepaging" attr-test="{{ totalnya }}">
      <ul>
        {% if this.page.p != 1 %}
          <li><a href="{{ this.page.baseFileName|page({ "page": this.page.p }) }}?p={{ this.page.p - 1 }}">&laquo;</a></li>
        {% endif %}
        {% for i in this.page.min_p..this.page.max_p %}
          <li>
            <a href="{{ this.page.baseFileName|page({ "page": i }) }}?p={{ i }}" {{ i == this.page.p ? 'class="disable"' : '' }}>
              {{ i }}
            </a>
          </li>
        {% endfor %}
        {% if this.page.p != this.page.total_page %}
          <li><a href="{{ this.page.baseFileName|page({ "page": page }) }}?p={{ this.page.p + 1 }}">&raquo;</a></li>
        {% endif %}
      </ul>                       
      <div attr= "{{ totalnya }}" class="paging-info">{{ 'halaman'|_ }} {{records.currentPage}} {{ 'dari'|_ }} {{records.lastPage}}</div>
    </div>