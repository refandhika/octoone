title = "Our Milkpedia Archive"
url = "/milkpedia/:slug"
layout = "default"
meta_description = "Selamat datang di Milkpedia. Dapatkan informasi seputar nutrisi dan kesehatan serta segala manfaat kebaikan susu yang bermanfaat bagi Anda dan keluarga."
is_hidden = 0

[builderDetails]
modelClass = "Definite\Milkpedia\Models\Category"
identifierValue = "{{ :slug }}"
modelKeyColumn = "slug"
displayColumn = "title"
notFoundMessage = "Record not found"
==
function onEnd() {
    if (is_null($this->components['builderDetails']->record)) return $this->controller->run('404');
    
    // get the post component
    $_title = $this->page->components["builderDetails"]->record->attributes["title"];
    $_title_en = $this->page->components["builderDetails"]->record->attributes["title_en"];
    $_meta_description = $this->page->components["builderDetails"]->record->attributes["meta_description"];
    $_meta_keywords = $this->page->components["builderDetails"]->record->attributes["meta_keywords"];

    if($_title == "Kapan & Bagaimana Cara Minum Susu"){
        $this->page->title = "Cara dan Waktu Terbaik Minum Susu";
    } else {
        $this->page->title = $_title;
    }

    $this->page->meta_title = $this->page->components["builderDetails"]->record->attributes["meta_title"];
    $this->page->meta_description = $_meta_description;
    $this->page->meta_keywords = $_meta_keywords;
    
    $this->page->meta_title_en = $this->page->components["builderDetails"]->record->attributes["meta_title_en"];
    $this->page->meta_description_en = $this->page->components["builderDetails"]->record->attributes["meta_description_en"];
    $this->page->meta_keywords_en = $this->page->components["builderDetails"]->record->attributes["meta_keywords_en"];
}
==
{% set record = builderDetails.record %}
{% set displayColumn = builderDetails.displayColumn %}
{% set notFoundMessage = builderDetails.notFoundMessage %}

<h1 aria-hidden="true" class="seo-heading">{{ record.title }}</h1>

<div class="static-baner-pages">
    <div class="imgwrp hidden-xs"><img src="{{ 'assets/img/95-TAHUN-FF_desktop-banner.jpg'|theme }}" alt="Banner 95 Tahun Frisian Flag Desktop"/> </div>
    <div class="imgwrp visible-xs"><img src="{{ 'assets/img/95-TAHUN-FF_mobile-banner.jpg'|theme }}" alt="Banner 95 Tahun Frisian Flag Mobile"/> </div>
</div>
    {{key}}
<div class="container-menutab">
    <div class="container-one">
        <ul>
            <li class="toggle visible-xs visible-sm"><a href="javascript:;" class="active">{{ record.title }}</a></li>
            {% for category in record.all %}
            <li>
                <a href="{{ category.slug }}" {% if category.slug == record.slug %} class="active" {% endif %}>
                    {{ trans_pick(category, 'title') }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<div id='main-section'>
    <div class="col-md-12">
        <div class="breadcrumb">
            <div class="container-two">
                <ul>
                    <li>
                        <a href="{{ 'home'|page }}">{{ 'beranda'|_ }}</a>
                    </li>
                    <li>
                        <a href="#">Milkpedia</a>
                    </li>
                    <li>
                        <a href="{{ 'our-milkpedia'|page({ "slug": record.slug }) }}">
                            {{ trans_pick(record, 'title') }}
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    {% if record %}
        {% set milkpedias = record.posts.take(7) %}
        {% set latest = milkpedias.first() %}

        <div class="col-md-12">
            <div class="default-content">
                <div class="container-two">
                    <h3>{{ trans_pick(record, "title") }}</h3>
                    <p>{{ trans_pick(record, "description") | raw}}</p>
                </div>
            </div>
        </div>

        {% if latest %}
            <div class="col-md-6" style="margin-top: 40px">
                <div class="wrp-halfcontent">
                    <div class="imgfull">
                        {% if latest.featured_image %}
                            <img src="{{ latest.featured_image| mediathumb_resize('width', 720, 90)  }}" alt="{{ latest.title }}"/>
                        {% else %}
                            <img src="http://placehold.it/703x545/797979/666666?text=No+Image" alt="No Image"/>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-6" style="margin-top: 40px">
                <div class="content-fullhalf">
                    <div class="date">
                        <label>Nutrient</label> | {{ latest.created_at.format('d M Y') }}
                    </div>
                    <div class="content">
                        <h3>{{ trans_pick(latest, 'title') }}</h3>
                        <p>{{ trans_pick(latest, 'excerpt')|raw }}</p>

                        <a href="{{ 'our-milkpedia-single'|page({"category-slug": record.slug, "slug": latest.slug}) }}" class="button btnblue" style="text-transform: uppercase">{{ 'lebih-lanjut'|_ }}</a>
                    </div>
                </div>
            </div>
        {% endif %}

        <div id="ourmilkpedia" class="section section_card clearfix">
            {% for milkpedia in milkpedias %}
              {% if loop.index0 != 0 %}
                <div class="col-sm-4 itemhomefade">
                    <div class="card card_featured">
                        <div class="card__thumbnail">
                            <div class="card__image">
                                {% if milkpedia.featured_image %}
                                    <img src="{{ milkpedia.featured_image| mediathumb_resize('width', 640, 90)  }}" alt="{{ milkpedia.title }}"/>
                                {% else %}
                                    <img src="http://placehold.it/600x600/797979/666666?text=No+Image" alt="No Image"/>
                                {% endif %}
                            </div>

                            <div class="card__meta">
                                <header class="card__head">
                                    <h3><a href="{{ 'our-milkpedia-single'|page({"category-slug": milkpedia.category.slug, "slug": milkpedia.slug}) }}">{{ milkpedia.title }}</a></h3>
                                </header>
                                <a href="{{ 'our-milkpedia-single'|page({"category-slug": milkpedia.category.slug, "slug": milkpedia.slug}) }}" class="button hidden-xs">{{ 'lebih-lanjut'|_ }}</a>
                            </div>
                        </div>
                    </div>
                </div>
              {% endif %}
            {% endfor %}
        </div>

        <div id="result-container" style="clear: both;">
            <div class="col-sm-4" v-for="(row, index) in posts">
                    <div class="card card_featured">
                        <div class="card__thumbnail">
                            <div class="card__image" :style="'background-image: url(/storage/app/media' + encodeURI(row.featured_image) + ');'">
                                <img :src="'/storage/app/media' + row.featured_image" :alt="row.title"/>
                            </div>

                            <div class="card__meta">
                                <header class="card__head">
                                    <h3><a :href="'/milkpedia/{{ record.slug }}/' + row.slug" v-html="row.title"></a></h3>
                                </header>
                                <a :href="'/milkpedia/{{ record.slug }}/' + row.slug" class="button hidden-xs">{{ 'lebih-lanjut'|_ }}</a>
                            </div>
                        </div>
                    </div>
                </div>

            <div class="text-center loader" v-if="isLoading"><img src="{{ 'assets/img/loader.gif'|theme }}" alt="Loader"></div>
        </div>

    {% else %}
        {{ notFoundMessage }}
    {% endif %}

</div> <!-- end mainsection -->

{% put scripts %}
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.0"></script>
<script>
    'use strict';

    (function() {

        // Init
        var app = new Vue({
            el: '#result-container',
            data: {
                canLoadmore: true,
                isLoading: false,
                containerTop: 0,
                page: 2,
                posts: []
            },
            mounted: function()
            {
                // Set window scroll to top
                window.scrollTo(0, 0);

                // Init
                var $container = document.getElementById('result-container');
                var containerRect = $container.getBoundingClientRect();
                var containerTop = Math.floor(containerRect.top);
                var self = this;
                
                // Setup
                self.containerTop = containerTop;

                // Window scroll
                window.addEventListener('scroll', function(e) {
                    // Get window top
                    var windowTop = window.pageYOffset;
                    
                    if (windowTop > (self.containerTop + $container.scrollHeight + 200) && self.canLoadmore)
                    {
                        // Set loading
                        self.isLoading = true;

                        // Call API
                        self.$http.get('{{ url("/api/milkpedia") }}', {
                            params: {
                                slug: '{{ record.slug }}',
                                page: self.page
                            }
                        }).then(self.loadData);

                        // Set can loadmore to false
                        self.canLoadmore = false;
                    }
                });
            },
            computed: {},
            methods: {
                loadData: function(res)
                {
                    // Init
                    var response = res.body;
                    var self = this;
                    var result = response.data;
                    var $container = document.getElementById('result-container');

                    // Check data
                    if (result && result.data.length > 0)
                    {
                        // Set Data
                        result.data.forEach(function(row) {
                            self.posts.push(row);
                        });

                        // Check next page
                        if (result.next_page_url)
                        {
                            // Increase page
                            self.page++;
                            
                            // Set can load more
                            self.canLoadmore = true;
                        }

                        // Hide Loading
                        self.isLoading = false;
                    }
                    else
                    {
                        self.isLoading = false;
                    }
                }
            }
        });

    })();
</script>
{% endput %}